/gold-investment-backend$ python -m pytest tests/ -v
========================================== test session starts ==========================================
platform linux -- Python 3.11.10, pytest-7.4.3, pluggy-1.5.0 -- /home/runner/gold-investment-backend/.pythonlibs/bin/python
cachedir: .pytest_cache
rootdir: /home/runner/gold-investment-backend/tests
configfile: pytest.ini
plugins: mock-3.14.0, web3-6.11.4, asyncio-0.21.1
asyncio: mode=Mode.AUTO
collected 40 items                                                                                      

tests/test_api.py::test_transform_endpoint ERROR                                                  [  2%]
tests/test_auth.py::test_noble_relation_verification ERROR                                        [  5%]
tests/test_auth.py::test_token_verification ERROR                                                 [  7%]
tests/test_auth.py::test_invalid_token ERROR                                                      [ 10%]
tests/test_batch_collection_service.py::TestBatchCollectionService::test_duplicate_transaction_references FAILED [ 12%]
tests/test_batch_collection_service.py::TestBatchCollectionService::test_empty_transaction_batch FAILED [ 15%]
tests/test_batch_collection_service.py::TestBatchCollectionService::test_invalid_gold_transfer FAILED [ 17%]
tests/test_batch_collection_service.py::TestBatchCollectionService::test_large_transaction_batch FAILED [ 20%]
tests/test_batch_collection_service.py::TestBatchCollectionService::test_process_batch_transfers FAILED [ 22%]
tests/test_blockchain_integration.py::test_contract_deployment FAILED                             [ 25%]
tests/test_blockchain_integration.py::test_connection FAILED                                      [ 27%]
tests/test_blockchain_service.py::test_batch_transform FAILED                                     [ 30%]
tests/test_blockchain_service.py::test_noble_rank_update FAILED                                   [ 32%]
tests/test_blockchain_service.py::test_gas_optimization FAILED                                    [ 35%]
tests/test_bonus_system.py::test_bonus_calculation ERROR                                          [ 37%]
tests/test_bonus_system.py::test_bonus_distribution ERROR                                         [ 40%]
tests/test_bonus_system.py::test_rank_based_bonus ERROR                                           [ 42%]
tests/test_bonus_system.py::test_multi_level_bonus_distribution ERROR                             [ 45%]
tests/test_complete_system.py::test_system_health ERROR                                           [ 47%]
tests/test_complete_system.py::test_user_balance ERROR                                            [ 50%]
tests/test_complete_system.py::test_transformation_flow ERROR                                     [ 52%]
tests/test_multi_device.py::test_responsive_layout[desktop-device0] FAILED                        [ 55%]
tests/test_multi_device.py::test_responsive_layout[mobile-device1] FAILED                         [ 57%]
tests/test_multi_device.py::test_responsive_layout[tablet-device2] FAILED                         [ 60%]
tests/test_noble_system.py::test_noble_rank_creation PASSED                                       [ 62%]
tests/test_noble_system.py::test_noble_relation_verification PASSED                               [ 65%]
tests/test_rate_limiting.py::TestRobustRateLimiter::test_local_rate_limiting FAILED               [ 67%]
tests/test_rate_limiting.py::TestRobustRateLimiter::test_redis_rate_limiting FAILED               [ 70%]
tests/test_rate_limiting.py::TestRobustRateLimiter::test_window_expiration FAILED                 [ 72%]
tests/test_rate_limiting.py::TestRobustRateLimiter::test_redis_window_expiration FAILED           [ 75%]
tests/test_rate_limiting.py::TestRobustRateLimiter::test_identifier_generation FAILED             [ 77%]
tests/test_rate_limiting.py::TestRobustRateLimiter::test_rate_limit_configurations[1-1-True] FAILED [ 80%]
tests/test_rate_limiting.py::TestRobustRateLimiter::test_rate_limit_configurations[1-1-False] FAILED [ 82%]
tests/test_rate_limiting.py::TestRobustRateLimiter::test_rate_limit_configurations[5-1-True] FAILED [ 85%]
tests/test_rate_limiting.py::TestRobustRateLimiter::test_rate_limit_configurations[0-1-False] FAILED [ 87%]
tests/test_rate_limiting.py::TestRobustRateLimiter::test_redis_failure_fallback FAILED            [ 90%]
tests/test_system_flow.py::test_complete_transformation_flow FAILED                               [ 92%]
tests/test_transformation_service.py::test_transform_to_gold FAILED                               [ 95%]
tests/integration/test_batch_blockchain.py::test_batch_blockchain_integration ERROR               [ 97%]
tests/integration/test_batch_blockchain.py::test_batch_validation ERROR                           [100%]

================================================ ERRORS =================================================
_______________________________ ERROR at setup of test_transform_endpoint _______________________________
tests/test_api.py:9: in app
    app = create_app()
app/__init__.py:59: in create_app
    db.create_all()
.pythonlibs/lib/python3.11/site-packages/flask_sqlalchemy/extension.py:868: in create_all
    self._call_for_binds(bind_key, "create_all")
.pythonlibs/lib/python3.11/site-packages/flask_sqlalchemy/extension.py:849: in _call_for_binds
    getattr(metadata, op_name)(bind=engine)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:5828: in create_all
    bind._run_ddl_visitor(
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py:3243: in _run_ddl_visitor
    conn._run_ddl_visitor(visitorcallable, element, **kwargs)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py:2447: in _run_ddl_visitor
    visitorcallable(self.dialect, self, **kwargs).traverse_single(element)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/visitors.py:671: in traverse_single
    return meth(obj, **kw)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/ddl.py:897: in visit_metadata
    collection = sort_tables_and_constraints(
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/ddl.py:1327: in sort_tables_and_constraints
    dependent_on = fkc.referred_table
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:4751: in referred_table
    return self.elements[0].column.table
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py:1146: in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:3159: in column
    return self._resolve_column()
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:3182: in _resolve_column
    raise exc.NoReferencedTableError(
E   sqlalchemy.exc.NoReferencedTableError: Foreign key associated with column 'bonus_transactions.user_id' could not find table 'users' with which to generate a foreign key to target column 'id'
__________________________ ERROR at setup of test_noble_relation_verification ___________________________
tests/test_auth.py:10: in app
    app = create_app()
app/__init__.py:59: in create_app
    db.create_all()
.pythonlibs/lib/python3.11/site-packages/flask_sqlalchemy/extension.py:868: in create_all
    self._call_for_binds(bind_key, "create_all")
.pythonlibs/lib/python3.11/site-packages/flask_sqlalchemy/extension.py:849: in _call_for_binds
    getattr(metadata, op_name)(bind=engine)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:5828: in create_all
    bind._run_ddl_visitor(
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py:3243: in _run_ddl_visitor
    conn._run_ddl_visitor(visitorcallable, element, **kwargs)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py:2447: in _run_ddl_visitor
    visitorcallable(self.dialect, self, **kwargs).traverse_single(element)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/visitors.py:671: in traverse_single
    return meth(obj, **kw)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/ddl.py:897: in visit_metadata
    collection = sort_tables_and_constraints(
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/ddl.py:1327: in sort_tables_and_constraints
    dependent_on = fkc.referred_table
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:4751: in referred_table
    return self.elements[0].column.table
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py:1146: in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:3159: in column
    return self._resolve_column()
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:3182: in _resolve_column
    raise exc.NoReferencedTableError(
E   sqlalchemy.exc.NoReferencedTableError: Foreign key associated with column 'bonus_transactions.user_id' could not find table 'users' with which to generate a foreign key to target column 'id'
_______________________________ ERROR at setup of test_token_verification _______________________________
tests/test_auth.py:10: in app
    app = create_app()
app/__init__.py:59: in create_app
    db.create_all()
.pythonlibs/lib/python3.11/site-packages/flask_sqlalchemy/extension.py:868: in create_all
    self._call_for_binds(bind_key, "create_all")
.pythonlibs/lib/python3.11/site-packages/flask_sqlalchemy/extension.py:849: in _call_for_binds
    getattr(metadata, op_name)(bind=engine)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:5828: in create_all
    bind._run_ddl_visitor(
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py:3243: in _run_ddl_visitor
    conn._run_ddl_visitor(visitorcallable, element, **kwargs)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py:2447: in _run_ddl_visitor
    visitorcallable(self.dialect, self, **kwargs).traverse_single(element)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/visitors.py:671: in traverse_single
    return meth(obj, **kw)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/ddl.py:897: in visit_metadata
    collection = sort_tables_and_constraints(
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/ddl.py:1327: in sort_tables_and_constraints
    dependent_on = fkc.referred_table
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:4751: in referred_table
    return self.elements[0].column.table
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py:1146: in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:3159: in column
    return self._resolve_column()
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:3182: in _resolve_column
    raise exc.NoReferencedTableError(
E   sqlalchemy.exc.NoReferencedTableError: Foreign key associated with column 'bonus_transactions.user_id' could not find table 'users' with which to generate a foreign key to target column 'id'
_________________________________ ERROR at setup of test_invalid_token __________________________________
tests/test_auth.py:10: in app
    app = create_app()
app/__init__.py:59: in create_app
    db.create_all()
.pythonlibs/lib/python3.11/site-packages/flask_sqlalchemy/extension.py:868: in create_all
    self._call_for_binds(bind_key, "create_all")
.pythonlibs/lib/python3.11/site-packages/flask_sqlalchemy/extension.py:849: in _call_for_binds
    getattr(metadata, op_name)(bind=engine)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:5828: in create_all
    bind._run_ddl_visitor(
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py:3243: in _run_ddl_visitor
    conn._run_ddl_visitor(visitorcallable, element, **kwargs)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py:2447: in _run_ddl_visitor
    visitorcallable(self.dialect, self, **kwargs).traverse_single(element)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/visitors.py:671: in traverse_single
    return meth(obj, **kw)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/ddl.py:897: in visit_metadata
    collection = sort_tables_and_constraints(
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/ddl.py:1327: in sort_tables_and_constraints
    dependent_on = fkc.referred_table
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:4751: in referred_table
    return self.elements[0].column.table
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py:1146: in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:3159: in column
    return self._resolve_column()
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:3182: in _resolve_column
    raise exc.NoReferencedTableError(
E   sqlalchemy.exc.NoReferencedTableError: Foreign key associated with column 'bonus_transactions.user_id' could not find table 'users' with which to generate a foreign key to target column 'id'
_______________________________ ERROR at setup of test_bonus_calculation ________________________________
.pythonlibs/lib/python3.11/site-packages/pytest_asyncio/plugin.py:304: in _asyncgen_fixture_wrapper
    result = event_loop.run_until_complete(setup())
/nix/store/clx0mcir7qw8zk36zbr4jra789g3knf6-python3-3.11.10/lib/python3.11/asyncio/base_events.py:654: in run_until_complete
    return future.result()
.pythonlibs/lib/python3.11/site-packages/pytest_asyncio/plugin.py:286: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:16: in app
    app = create_app()
app/__init__.py:59: in create_app
    db.create_all()
.pythonlibs/lib/python3.11/site-packages/flask_sqlalchemy/extension.py:868: in create_all
    self._call_for_binds(bind_key, "create_all")
.pythonlibs/lib/python3.11/site-packages/flask_sqlalchemy/extension.py:849: in _call_for_binds
    getattr(metadata, op_name)(bind=engine)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:5828: in create_all
    bind._run_ddl_visitor(
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py:3243: in _run_ddl_visitor
    conn._run_ddl_visitor(visitorcallable, element, **kwargs)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py:2447: in _run_ddl_visitor
    visitorcallable(self.dialect, self, **kwargs).traverse_single(element)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/visitors.py:671: in traverse_single
    return meth(obj, **kw)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/ddl.py:897: in visit_metadata
    collection = sort_tables_and_constraints(
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/ddl.py:1327: in sort_tables_and_constraints
    dependent_on = fkc.referred_table
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:4751: in referred_table
    return self.elements[0].column.table
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py:1146: in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:3159: in column
    return self._resolve_column()
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:3182: in _resolve_column
    raise exc.NoReferencedTableError(
E   sqlalchemy.exc.NoReferencedTableError: Foreign key associated with column 'bonus_transactions.user_id' could not find table 'users' with which to generate a foreign key to target column 'id'
_______________________________ ERROR at setup of test_bonus_distribution _______________________________
.pythonlibs/lib/python3.11/site-packages/pytest_asyncio/plugin.py:304: in _asyncgen_fixture_wrapper
    result = event_loop.run_until_complete(setup())
/nix/store/clx0mcir7qw8zk36zbr4jra789g3knf6-python3-3.11.10/lib/python3.11/asyncio/base_events.py:654: in run_until_complete
    return future.result()
.pythonlibs/lib/python3.11/site-packages/pytest_asyncio/plugin.py:286: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:16: in app
    app = create_app()
app/__init__.py:59: in create_app
    db.create_all()
.pythonlibs/lib/python3.11/site-packages/flask_sqlalchemy/extension.py:868: in create_all
    self._call_for_binds(bind_key, "create_all")
.pythonlibs/lib/python3.11/site-packages/flask_sqlalchemy/extension.py:849: in _call_for_binds
    getattr(metadata, op_name)(bind=engine)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:5828: in create_all
    bind._run_ddl_visitor(
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py:3243: in _run_ddl_visitor
    conn._run_ddl_visitor(visitorcallable, element, **kwargs)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py:2447: in _run_ddl_visitor
    visitorcallable(self.dialect, self, **kwargs).traverse_single(element)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/visitors.py:671: in traverse_single
    return meth(obj, **kw)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/ddl.py:897: in visit_metadata
    collection = sort_tables_and_constraints(
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/ddl.py:1327: in sort_tables_and_constraints
    dependent_on = fkc.referred_table
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:4751: in referred_table
    return self.elements[0].column.table
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py:1146: in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:3159: in column
    return self._resolve_column()
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:3182: in _resolve_column
    raise exc.NoReferencedTableError(
E   sqlalchemy.exc.NoReferencedTableError: Foreign key associated with column 'bonus_transactions.user_id' could not find table 'users' with which to generate a foreign key to target column 'id'
________________________________ ERROR at setup of test_rank_based_bonus ________________________________
.pythonlibs/lib/python3.11/site-packages/pytest_asyncio/plugin.py:304: in _asyncgen_fixture_wrapper
    result = event_loop.run_until_complete(setup())
/nix/store/clx0mcir7qw8zk36zbr4jra789g3knf6-python3-3.11.10/lib/python3.11/asyncio/base_events.py:654: in run_until_complete
    return future.result()
.pythonlibs/lib/python3.11/site-packages/pytest_asyncio/plugin.py:286: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:16: in app
    app = create_app()
app/__init__.py:59: in create_app
    db.create_all()
.pythonlibs/lib/python3.11/site-packages/flask_sqlalchemy/extension.py:868: in create_all
    self._call_for_binds(bind_key, "create_all")
.pythonlibs/lib/python3.11/site-packages/flask_sqlalchemy/extension.py:849: in _call_for_binds
    getattr(metadata, op_name)(bind=engine)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:5828: in create_all
    bind._run_ddl_visitor(
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py:3243: in _run_ddl_visitor
    conn._run_ddl_visitor(visitorcallable, element, **kwargs)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py:2447: in _run_ddl_visitor
    visitorcallable(self.dialect, self, **kwargs).traverse_single(element)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/visitors.py:671: in traverse_single
    return meth(obj, **kw)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/ddl.py:897: in visit_metadata
    collection = sort_tables_and_constraints(
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/ddl.py:1327: in sort_tables_and_constraints
    dependent_on = fkc.referred_table
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:4751: in referred_table
    return self.elements[0].column.table
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py:1146: in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:3159: in column
    return self._resolve_column()
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:3182: in _resolve_column
    raise exc.NoReferencedTableError(
E   sqlalchemy.exc.NoReferencedTableError: Foreign key associated with column 'bonus_transactions.user_id' could not find table 'users' with which to generate a foreign key to target column 'id'
_________________________ ERROR at setup of test_multi_level_bonus_distribution _________________________
.pythonlibs/lib/python3.11/site-packages/pytest_asyncio/plugin.py:304: in _asyncgen_fixture_wrapper
    result = event_loop.run_until_complete(setup())
/nix/store/clx0mcir7qw8zk36zbr4jra789g3knf6-python3-3.11.10/lib/python3.11/asyncio/base_events.py:654: in run_until_complete
    return future.result()
.pythonlibs/lib/python3.11/site-packages/pytest_asyncio/plugin.py:286: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:16: in app
    app = create_app()
app/__init__.py:59: in create_app
    db.create_all()
.pythonlibs/lib/python3.11/site-packages/flask_sqlalchemy/extension.py:868: in create_all
    self._call_for_binds(bind_key, "create_all")
.pythonlibs/lib/python3.11/site-packages/flask_sqlalchemy/extension.py:849: in _call_for_binds
    getattr(metadata, op_name)(bind=engine)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:5828: in create_all
    bind._run_ddl_visitor(
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py:3243: in _run_ddl_visitor
    conn._run_ddl_visitor(visitorcallable, element, **kwargs)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py:2447: in _run_ddl_visitor
    visitorcallable(self.dialect, self, **kwargs).traverse_single(element)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/visitors.py:671: in traverse_single
    return meth(obj, **kw)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/ddl.py:897: in visit_metadata
    collection = sort_tables_and_constraints(
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/ddl.py:1327: in sort_tables_and_constraints
    dependent_on = fkc.referred_table
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:4751: in referred_table
    return self.elements[0].column.table
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py:1146: in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:3159: in column
    return self._resolve_column()
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:3182: in _resolve_column
    raise exc.NoReferencedTableError(
E   sqlalchemy.exc.NoReferencedTableError: Foreign key associated with column 'bonus_transactions.user_id' could not find table 'users' with which to generate a foreign key to target column 'id'
_________________________________ ERROR at setup of test_system_health __________________________________
tests/test_complete_system.py:11: in app
    app = create_app(TestConfig)
app/__init__.py:59: in create_app
    db.create_all()
.pythonlibs/lib/python3.11/site-packages/flask_sqlalchemy/extension.py:868: in create_all
    self._call_for_binds(bind_key, "create_all")
.pythonlibs/lib/python3.11/site-packages/flask_sqlalchemy/extension.py:849: in _call_for_binds
    getattr(metadata, op_name)(bind=engine)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:5828: in create_all
    bind._run_ddl_visitor(
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py:3243: in _run_ddl_visitor
    conn._run_ddl_visitor(visitorcallable, element, **kwargs)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py:2447: in _run_ddl_visitor
    visitorcallable(self.dialect, self, **kwargs).traverse_single(element)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/visitors.py:671: in traverse_single
    return meth(obj, **kw)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/ddl.py:897: in visit_metadata
    collection = sort_tables_and_constraints(
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/ddl.py:1327: in sort_tables_and_constraints
    dependent_on = fkc.referred_table
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:4751: in referred_table
    return self.elements[0].column.table
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py:1146: in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:3159: in column
    return self._resolve_column()
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:3182: in _resolve_column
    raise exc.NoReferencedTableError(
E   sqlalchemy.exc.NoReferencedTableError: Foreign key associated with column 'bonus_transactions.user_id' could not find table 'users' with which to generate a foreign key to target column 'id'
__________________________________ ERROR at setup of test_user_balance __________________________________
tests/test_complete_system.py:11: in app
    app = create_app(TestConfig)
app/__init__.py:59: in create_app
    db.create_all()
.pythonlibs/lib/python3.11/site-packages/flask_sqlalchemy/extension.py:868: in create_all
    self._call_for_binds(bind_key, "create_all")
.pythonlibs/lib/python3.11/site-packages/flask_sqlalchemy/extension.py:849: in _call_for_binds
    getattr(metadata, op_name)(bind=engine)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:5828: in create_all
    bind._run_ddl_visitor(
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py:3243: in _run_ddl_visitor
    conn._run_ddl_visitor(visitorcallable, element, **kwargs)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py:2447: in _run_ddl_visitor
    visitorcallable(self.dialect, self, **kwargs).traverse_single(element)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/visitors.py:671: in traverse_single
    return meth(obj, **kw)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/ddl.py:897: in visit_metadata
    collection = sort_tables_and_constraints(
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/ddl.py:1327: in sort_tables_and_constraints
    dependent_on = fkc.referred_table
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:4751: in referred_table
    return self.elements[0].column.table
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py:1146: in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:3159: in column
    return self._resolve_column()
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:3182: in _resolve_column
    raise exc.NoReferencedTableError(
E   sqlalchemy.exc.NoReferencedTableError: Foreign key associated with column 'bonus_transactions.user_id' could not find table 'users' with which to generate a foreign key to target column 'id'
______________________________ ERROR at setup of test_transformation_flow _______________________________
tests/test_complete_system.py:11: in app
    app = create_app(TestConfig)
app/__init__.py:59: in create_app
    db.create_all()
.pythonlibs/lib/python3.11/site-packages/flask_sqlalchemy/extension.py:868: in create_all
    self._call_for_binds(bind_key, "create_all")
.pythonlibs/lib/python3.11/site-packages/flask_sqlalchemy/extension.py:849: in _call_for_binds
    getattr(metadata, op_name)(bind=engine)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:5828: in create_all
    bind._run_ddl_visitor(
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py:3243: in _run_ddl_visitor
    conn._run_ddl_visitor(visitorcallable, element, **kwargs)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py:2447: in _run_ddl_visitor
    visitorcallable(self.dialect, self, **kwargs).traverse_single(element)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/visitors.py:671: in traverse_single
    return meth(obj, **kw)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/ddl.py:897: in visit_metadata
    collection = sort_tables_and_constraints(
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/ddl.py:1327: in sort_tables_and_constraints
    dependent_on = fkc.referred_table
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:4751: in referred_table
    return self.elements[0].column.table
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py:1146: in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:3159: in column
    return self._resolve_column()
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:3182: in _resolve_column
    raise exc.NoReferencedTableError(
E   sqlalchemy.exc.NoReferencedTableError: Foreign key associated with column 'bonus_transactions.user_id' could not find table 'users' with which to generate a foreign key to target column 'id'
__________________________ ERROR at setup of test_batch_blockchain_integration __________________________
.pythonlibs/lib/python3.11/site-packages/pytest_asyncio/plugin.py:304: in _asyncgen_fixture_wrapper
    result = event_loop.run_until_complete(setup())
/nix/store/clx0mcir7qw8zk36zbr4jra789g3knf6-python3-3.11.10/lib/python3.11/asyncio/base_events.py:654: in run_until_complete
    return future.result()
.pythonlibs/lib/python3.11/site-packages/pytest_asyncio/plugin.py:286: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:16: in app
    app = create_app()
app/__init__.py:59: in create_app
    db.create_all()
.pythonlibs/lib/python3.11/site-packages/flask_sqlalchemy/extension.py:868: in create_all
    self._call_for_binds(bind_key, "create_all")
.pythonlibs/lib/python3.11/site-packages/flask_sqlalchemy/extension.py:849: in _call_for_binds
    getattr(metadata, op_name)(bind=engine)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:5828: in create_all
    bind._run_ddl_visitor(
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py:3243: in _run_ddl_visitor
    conn._run_ddl_visitor(visitorcallable, element, **kwargs)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py:2447: in _run_ddl_visitor
    visitorcallable(self.dialect, self, **kwargs).traverse_single(element)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/visitors.py:671: in traverse_single
    return meth(obj, **kw)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/ddl.py:897: in visit_metadata
    collection = sort_tables_and_constraints(
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/ddl.py:1327: in sort_tables_and_constraints
    dependent_on = fkc.referred_table
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:4751: in referred_table
    return self.elements[0].column.table
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py:1146: in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:3159: in column
    return self._resolve_column()
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:3182: in _resolve_column
    raise exc.NoReferencedTableError(
E   sqlalchemy.exc.NoReferencedTableError: Foreign key associated with column 'bonus_transactions.user_id' could not find table 'users' with which to generate a foreign key to target column 'id'
________________________________ ERROR at setup of test_batch_validation ________________________________
.pythonlibs/lib/python3.11/site-packages/pytest_asyncio/plugin.py:304: in _asyncgen_fixture_wrapper
    result = event_loop.run_until_complete(setup())
/nix/store/clx0mcir7qw8zk36zbr4jra789g3knf6-python3-3.11.10/lib/python3.11/asyncio/base_events.py:654: in run_until_complete
    return future.result()
.pythonlibs/lib/python3.11/site-packages/pytest_asyncio/plugin.py:286: in setup
    res = await gen_obj.__anext__()
tests/conftest.py:16: in app
    app = create_app()
app/__init__.py:59: in create_app
    db.create_all()
.pythonlibs/lib/python3.11/site-packages/flask_sqlalchemy/extension.py:868: in create_all
    self._call_for_binds(bind_key, "create_all")
.pythonlibs/lib/python3.11/site-packages/flask_sqlalchemy/extension.py:849: in _call_for_binds
    getattr(metadata, op_name)(bind=engine)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:5828: in create_all
    bind._run_ddl_visitor(
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py:3243: in _run_ddl_visitor
    conn._run_ddl_visitor(visitorcallable, element, **kwargs)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py:2447: in _run_ddl_visitor
    visitorcallable(self.dialect, self, **kwargs).traverse_single(element)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/visitors.py:671: in traverse_single
    return meth(obj, **kw)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/ddl.py:897: in visit_metadata
    collection = sort_tables_and_constraints(
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/ddl.py:1327: in sort_tables_and_constraints
    dependent_on = fkc.referred_table
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:4751: in referred_table
    return self.elements[0].column.table
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py:1146: in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:3159: in column
    return self._resolve_column()
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:3182: in _resolve_column
    raise exc.NoReferencedTableError(
E   sqlalchemy.exc.NoReferencedTableError: Foreign key associated with column 'bonus_transactions.user_id' could not find table 'users' with which to generate a foreign key to target column 'id'
=============================================== FAILURES ================================================
___________________ TestBatchCollectionService.test_duplicate_transaction_references ____________________
tests/test_batch_collection_service.py:7: in asyncSetUp
    self.app = create_app()
app/__init__.py:59: in create_app
    db.create_all()
.pythonlibs/lib/python3.11/site-packages/flask_sqlalchemy/extension.py:868: in create_all
    self._call_for_binds(bind_key, "create_all")
.pythonlibs/lib/python3.11/site-packages/flask_sqlalchemy/extension.py:849: in _call_for_binds
    getattr(metadata, op_name)(bind=engine)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:5828: in create_all
    bind._run_ddl_visitor(
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py:3243: in _run_ddl_visitor
    conn._run_ddl_visitor(visitorcallable, element, **kwargs)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py:2447: in _run_ddl_visitor
    visitorcallable(self.dialect, self, **kwargs).traverse_single(element)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/visitors.py:671: in traverse_single
    return meth(obj, **kw)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/ddl.py:897: in visit_metadata
    collection = sort_tables_and_constraints(
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/ddl.py:1327: in sort_tables_and_constraints
    dependent_on = fkc.referred_table
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:4751: in referred_table
    return self.elements[0].column.table
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py:1146: in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:3159: in column
    return self._resolve_column()
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:3182: in _resolve_column
    raise exc.NoReferencedTableError(
E   sqlalchemy.exc.NoReferencedTableError: Foreign key associated with column 'bonus_transactions.user_id' could not find table 'users' with which to generate a foreign key to target column 'id'
________________________ TestBatchCollectionService.test_empty_transaction_batch ________________________
tests/test_batch_collection_service.py:7: in asyncSetUp
    self.app = create_app()
app/__init__.py:59: in create_app
    db.create_all()
.pythonlibs/lib/python3.11/site-packages/flask_sqlalchemy/extension.py:868: in create_all
    self._call_for_binds(bind_key, "create_all")
.pythonlibs/lib/python3.11/site-packages/flask_sqlalchemy/extension.py:849: in _call_for_binds
    getattr(metadata, op_name)(bind=engine)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:5828: in create_all
    bind._run_ddl_visitor(
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py:3243: in _run_ddl_visitor
    conn._run_ddl_visitor(visitorcallable, element, **kwargs)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py:2447: in _run_ddl_visitor
    visitorcallable(self.dialect, self, **kwargs).traverse_single(element)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/visitors.py:671: in traverse_single
    return meth(obj, **kw)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/ddl.py:897: in visit_metadata
    collection = sort_tables_and_constraints(
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/ddl.py:1327: in sort_tables_and_constraints
    dependent_on = fkc.referred_table
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:4751: in referred_table
    return self.elements[0].column.table
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py:1146: in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:3159: in column
    return self._resolve_column()
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:3182: in _resolve_column
    raise exc.NoReferencedTableError(
E   sqlalchemy.exc.NoReferencedTableError: Foreign key associated with column 'bonus_transactions.user_id' could not find table 'users' with which to generate a foreign key to target column 'id'
_________________________ TestBatchCollectionService.test_invalid_gold_transfer _________________________
tests/test_batch_collection_service.py:7: in asyncSetUp
    self.app = create_app()
app/__init__.py:59: in create_app
    db.create_all()
.pythonlibs/lib/python3.11/site-packages/flask_sqlalchemy/extension.py:868: in create_all
    self._call_for_binds(bind_key, "create_all")
.pythonlibs/lib/python3.11/site-packages/flask_sqlalchemy/extension.py:849: in _call_for_binds
    getattr(metadata, op_name)(bind=engine)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:5828: in create_all
    bind._run_ddl_visitor(
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py:3243: in _run_ddl_visitor
    conn._run_ddl_visitor(visitorcallable, element, **kwargs)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py:2447: in _run_ddl_visitor
    visitorcallable(self.dialect, self, **kwargs).traverse_single(element)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/visitors.py:671: in traverse_single
    return meth(obj, **kw)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/ddl.py:897: in visit_metadata
    collection = sort_tables_and_constraints(
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/ddl.py:1327: in sort_tables_and_constraints
    dependent_on = fkc.referred_table
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:4751: in referred_table
    return self.elements[0].column.table
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py:1146: in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:3159: in column
    return self._resolve_column()
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:3182: in _resolve_column
    raise exc.NoReferencedTableError(
E   sqlalchemy.exc.NoReferencedTableError: Foreign key associated with column 'bonus_transactions.user_id' could not find table 'users' with which to generate a foreign key to target column 'id'
________________________ TestBatchCollectionService.test_large_transaction_batch ________________________
tests/test_batch_collection_service.py:7: in asyncSetUp
    self.app = create_app()
app/__init__.py:59: in create_app
    db.create_all()
.pythonlibs/lib/python3.11/site-packages/flask_sqlalchemy/extension.py:868: in create_all
    self._call_for_binds(bind_key, "create_all")
.pythonlibs/lib/python3.11/site-packages/flask_sqlalchemy/extension.py:849: in _call_for_binds
    getattr(metadata, op_name)(bind=engine)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:5828: in create_all
    bind._run_ddl_visitor(
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py:3243: in _run_ddl_visitor
    conn._run_ddl_visitor(visitorcallable, element, **kwargs)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py:2447: in _run_ddl_visitor
    visitorcallable(self.dialect, self, **kwargs).traverse_single(element)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/visitors.py:671: in traverse_single
    return meth(obj, **kw)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/ddl.py:897: in visit_metadata
    collection = sort_tables_and_constraints(
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/ddl.py:1327: in sort_tables_and_constraints
    dependent_on = fkc.referred_table
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:4751: in referred_table
    return self.elements[0].column.table
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py:1146: in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:3159: in column
    return self._resolve_column()
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:3182: in _resolve_column
    raise exc.NoReferencedTableError(
E   sqlalchemy.exc.NoReferencedTableError: Foreign key associated with column 'bonus_transactions.user_id' could not find table 'users' with which to generate a foreign key to target column 'id'
________________________ TestBatchCollectionService.test_process_batch_transfers ________________________
tests/test_batch_collection_service.py:7: in asyncSetUp
    self.app = create_app()
app/__init__.py:59: in create_app
    db.create_all()
.pythonlibs/lib/python3.11/site-packages/flask_sqlalchemy/extension.py:868: in create_all
    self._call_for_binds(bind_key, "create_all")
.pythonlibs/lib/python3.11/site-packages/flask_sqlalchemy/extension.py:849: in _call_for_binds
    getattr(metadata, op_name)(bind=engine)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:5828: in create_all
    bind._run_ddl_visitor(
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py:3243: in _run_ddl_visitor
    conn._run_ddl_visitor(visitorcallable, element, **kwargs)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py:2447: in _run_ddl_visitor
    visitorcallable(self.dialect, self, **kwargs).traverse_single(element)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/visitors.py:671: in traverse_single
    return meth(obj, **kw)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/ddl.py:897: in visit_metadata
    collection = sort_tables_and_constraints(
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/ddl.py:1327: in sort_tables_and_constraints
    dependent_on = fkc.referred_table
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:4751: in referred_table
    return self.elements[0].column.table
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py:1146: in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:3159: in column
    return self._resolve_column()
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:3182: in _resolve_column
    raise exc.NoReferencedTableError(
E   sqlalchemy.exc.NoReferencedTableError: Foreign key associated with column 'bonus_transactions.user_id' could not find table 'users' with which to generate a foreign key to target column 'id'
_______________________________________ test_contract_deployment ________________________________________
tests/test_blockchain_integration.py:15: in test_contract_deployment
    result = blockchain_service.deploy_contract()
E   AttributeError: 'BlockchainService' object has no attribute 'deploy_contract'
____________________________________________ test_connection ____________________________________________
tests/test_blockchain_integration.py:22: in test_connection
    assert service.w3.isConnected()
E   AttributeError: 'Web3' object has no attribute 'isConnected'
------------------------------------------- Captured log call -------------------------------------------
INFO     gold-investment:blockchain_service.py:77 Connected to blockchain node: https://polygon-mumbai.g.alchemy.com/v2/your-key
_________________________________________ test_batch_transform __________________________________________
tests/test_blockchain_service.py:27: in test_batch_transform
    result = await blockchain_service.process_batch_transformation(
app/services/blockchain_service.py:18: in wrapper
    result = await func(*args, **kwargs)
E   TypeError: BlockchainService.process_batch_transformation() takes 2 positional arguments but 5 were given
------------------------------------------- Captured log call -------------------------------------------
ERROR    gold-investment:blockchain_service.py:36 Blockchain Transaction Error: BlockchainService.process_batch_transformation() takes 2 positional arguments but 5 were given
________________________________________ test_noble_rank_update _________________________________________
tests/test_blockchain_service.py:39: in test_noble_rank_update
    receipt = await blockchain_service.update_noble_rank(address, new_rank)
app/services/blockchain_service.py:18: in wrapper
    result = await func(*args, **kwargs)
app/utils/retry.py:26: in wrapper
    raise last_exception
app/utils/retry.py:17: in wrapper
    return await func(*args, **kwargs)
app/services/blockchain_service.py:122: in update_noble_rank
    raise ValueError("Blockchain connection or account not initialized")
E   ValueError: Blockchain connection or account not initialized
------------------------------------------- Captured log call -------------------------------------------
ERROR    gold-investment:blockchain_service.py:121 Blockchain connection or account not initialized
WARNING  app.utils.retry:retry.py:20 Attempt 1 failed: Blockchain connection or account not initialized
ERROR    gold-investment:blockchain_service.py:121 Blockchain connection or account not initialized
WARNING  app.utils.retry:retry.py:20 Attempt 2 failed: Blockchain connection or account not initialized
ERROR    gold-investment:blockchain_service.py:121 Blockchain connection or account not initialized
WARNING  app.utils.retry:retry.py:20 Attempt 3 failed: Blockchain connection or account not initialized
ERROR    app.utils.retry:retry.py:25 All 3 attempts failed
ERROR    gold-investment:blockchain_service.py:36 Blockchain Transaction Error: Blockchain connection or account not initialized
_________________________________________ test_gas_optimization _________________________________________
tests/test_blockchain_service.py:46: in test_gas_optimization
    gas_price = await blockchain_service._get_optimal_gas_price()
E   AttributeError: 'BlockchainService' object has no attribute '_get_optimal_gas_price'
________________________________ test_responsive_layout[desktop-device0] ________________________________
tests/test_multi_device.py:8: in test_responsive_layout
    app = create_app()
app/__init__.py:59: in create_app
    db.create_all()
.pythonlibs/lib/python3.11/site-packages/flask_sqlalchemy/extension.py:868: in create_all
    self._call_for_binds(bind_key, "create_all")
.pythonlibs/lib/python3.11/site-packages/flask_sqlalchemy/extension.py:849: in _call_for_binds
    getattr(metadata, op_name)(bind=engine)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:5828: in create_all
    bind._run_ddl_visitor(
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py:3243: in _run_ddl_visitor
    conn._run_ddl_visitor(visitorcallable, element, **kwargs)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py:2447: in _run_ddl_visitor
    visitorcallable(self.dialect, self, **kwargs).traverse_single(element)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/visitors.py:671: in traverse_single
    return meth(obj, **kw)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/ddl.py:897: in visit_metadata
    collection = sort_tables_and_constraints(
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/ddl.py:1327: in sort_tables_and_constraints
    dependent_on = fkc.referred_table
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:4751: in referred_table
    return self.elements[0].column.table
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py:1146: in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:3159: in column
    return self._resolve_column()
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:3182: in _resolve_column
    raise exc.NoReferencedTableError(
E   sqlalchemy.exc.NoReferencedTableError: Foreign key associated with column 'bonus_transactions.user_id' could not find table 'users' with which to generate a foreign key to target column 'id'
________________________________ test_responsive_layout[mobile-device1] _________________________________
tests/test_multi_device.py:8: in test_responsive_layout
    app = create_app()
app/__init__.py:59: in create_app
    db.create_all()
.pythonlibs/lib/python3.11/site-packages/flask_sqlalchemy/extension.py:868: in create_all
    self._call_for_binds(bind_key, "create_all")
.pythonlibs/lib/python3.11/site-packages/flask_sqlalchemy/extension.py:849: in _call_for_binds
    getattr(metadata, op_name)(bind=engine)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:5828: in create_all
    bind._run_ddl_visitor(
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py:3243: in _run_ddl_visitor
    conn._run_ddl_visitor(visitorcallable, element, **kwargs)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py:2447: in _run_ddl_visitor
    visitorcallable(self.dialect, self, **kwargs).traverse_single(element)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/visitors.py:671: in traverse_single
    return meth(obj, **kw)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/ddl.py:897: in visit_metadata
    collection = sort_tables_and_constraints(
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/ddl.py:1327: in sort_tables_and_constraints
    dependent_on = fkc.referred_table
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:4751: in referred_table
    return self.elements[0].column.table
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py:1146: in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:3159: in column
    return self._resolve_column()
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:3182: in _resolve_column
    raise exc.NoReferencedTableError(
E   sqlalchemy.exc.NoReferencedTableError: Foreign key associated with column 'bonus_transactions.user_id' could not find table 'users' with which to generate a foreign key to target column 'id'
________________________________ test_responsive_layout[tablet-device2] _________________________________
tests/test_multi_device.py:8: in test_responsive_layout
    app = create_app()
app/__init__.py:59: in create_app
    db.create_all()
.pythonlibs/lib/python3.11/site-packages/flask_sqlalchemy/extension.py:868: in create_all
    self._call_for_binds(bind_key, "create_all")
.pythonlibs/lib/python3.11/site-packages/flask_sqlalchemy/extension.py:849: in _call_for_binds
    getattr(metadata, op_name)(bind=engine)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:5828: in create_all
    bind._run_ddl_visitor(
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py:3243: in _run_ddl_visitor
    conn._run_ddl_visitor(visitorcallable, element, **kwargs)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/engine/base.py:2447: in _run_ddl_visitor
    visitorcallable(self.dialect, self, **kwargs).traverse_single(element)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/visitors.py:671: in traverse_single
    return meth(obj, **kw)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/ddl.py:897: in visit_metadata
    collection = sort_tables_and_constraints(
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/ddl.py:1327: in sort_tables_and_constraints
    dependent_on = fkc.referred_table
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:4751: in referred_table
    return self.elements[0].column.table
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/util/langhelpers.py:1146: in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:3159: in column
    return self._resolve_column()
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/sql/schema.py:3182: in _resolve_column
    raise exc.NoReferencedTableError(
E   sqlalchemy.exc.NoReferencedTableError: Foreign key associated with column 'bonus_transactions.user_id' could not find table 'users' with which to generate a foreign key to target column 'id'
____________________________ TestRobustRateLimiter.test_local_rate_limiting _____________________________
tests/test_rate_limiting.py:41: in test_local_rate_limiting
    limit = RateLimit(requests=2, window=1)
E   NameError: name 'RateLimit' is not defined
____________________________ TestRobustRateLimiter.test_redis_rate_limiting _____________________________
tests/test_rate_limiting.py:60: in test_redis_rate_limiting
    limit = RateLimit(requests=2, window=1)
E   NameError: name 'RateLimit' is not defined
_____________________________ TestRobustRateLimiter.test_window_expiration ______________________________
tests/test_rate_limiting.py:80: in test_window_expiration
    limit = RateLimit(requests=1, window=1)
E   NameError: name 'RateLimit' is not defined
__________________________ TestRobustRateLimiter.test_redis_window_expiration ___________________________
tests/test_rate_limiting.py:98: in test_redis_window_expiration
    limit = RateLimit(requests=1, window=1)
E   NameError: name 'RateLimit' is not defined
___________________________ TestRobustRateLimiter.test_identifier_generation ____________________________
tests/test_rate_limiting.py:117: in test_identifier_generation
    identifier = rate_limiter._get_identifier(by_ip=True, by_user=True)
E   AttributeError: 'RobustRateLimiter' object has no attribute '_get_identifier'
____________________ TestRobustRateLimiter.test_rate_limit_configurations[1-1-True] _____________________
tests/test_rate_limiting.py:136: in test_rate_limit_configurations
    limit = RateLimit(max_requests=max_requests, window_size=window_size)
E   NameError: name 'RateLimit' is not defined
____________________ TestRobustRateLimiter.test_rate_limit_configurations[1-1-False] ____________________
tests/test_rate_limiting.py:136: in test_rate_limit_configurations
    limit = RateLimit(max_requests=max_requests, window_size=window_size)
E   NameError: name 'RateLimit' is not defined
____________________ TestRobustRateLimiter.test_rate_limit_configurations[5-1-True] _____________________
tests/test_rate_limiting.py:136: in test_rate_limit_configurations
    limit = RateLimit(max_requests=max_requests, window_size=window_size)
E   NameError: name 'RateLimit' is not defined
____________________ TestRobustRateLimiter.test_rate_limit_configurations[0-1-False] ____________________
tests/test_rate_limiting.py:136: in test_rate_limit_configurations
    limit = RateLimit(max_requests=max_requests, window_size=window_size)
E   NameError: name 'RateLimit' is not defined
___________________________ TestRobustRateLimiter.test_redis_failure_fallback ___________________________
tests/test_rate_limiting.py:146: in test_redis_failure_fallback
    limit = RateLimit(requests=1, window=1)
E   NameError: name 'RateLimit' is not defined
___________________________________ test_complete_transformation_flow ___________________________________
tests/test_system_flow.py:24: in test_complete_transformation_flow
    result = await service.transform_to_gold(
app/services/transformation_service.py:20: in transform_to_gold
    async with db.session.begin_nested():
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/scoping.py:477: in begin_nested
    return self._proxied.begin_nested()
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/scoping.py:198: in _proxied
    return self.registry()
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/util/_collections.py:640: in __call__
    key = self.scopefunc()
.pythonlibs/lib/python3.11/site-packages/flask_sqlalchemy/session.py:81: in _app_ctx_id
    return id(app_ctx._get_current_object())  # type: ignore[attr-defined]
.pythonlibs/lib/python3.11/site-packages/werkzeug/local.py:513: in _get_current_object
    raise RuntimeError(unbound_message) from None
E   RuntimeError: Working outside of application context.
E   
E   This typically means that you attempted to use functionality that needed
E   the current application. To solve this, set up an application context
E   with app.app_context(). See the documentation for more information.
________________________________________ test_transform_to_gold _________________________________________
tests/test_transformation_service.py:19: in test_transform_to_gold
    result = await service.transform_to_gold(
app/services/transformation_service.py:20: in transform_to_gold
    async with db.session.begin_nested():
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/scoping.py:477: in begin_nested
    return self._proxied.begin_nested()
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/scoping.py:198: in _proxied
    return self.registry()
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/util/_collections.py:640: in __call__
    key = self.scopefunc()
.pythonlibs/lib/python3.11/site-packages/flask_sqlalchemy/session.py:81: in _app_ctx_id
    return id(app_ctx._get_current_object())  # type: ignore[attr-defined]
.pythonlibs/lib/python3.11/site-packages/werkzeug/local.py:513: in _get_current_object
    raise RuntimeError(unbound_message) from None
E   RuntimeError: Working outside of application context.
E   
E   This typically means that you attempted to use functionality that needed
E   the current application. To solve this, set up an application context
E   with app.app_context(). See the documentation for more information.
=========================================== warnings summary ============================================
config.py:80
  /home/runner/gold-investment-backend/config.py:80: PytestCollectionWarning: cannot collect test class 'TestConfig' because it has a __init__ constructor (from: test_complete_system.py)
    class TestConfig(Config):

tests/test_rate_limiting.py:56
  /home/runner/gold-investment-backend/tests/test_rate_limiting.py:56: PytestUnknownMarkWarning: Unknown pytest.mark.redis - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.redis

tests/test_rate_limiting.py:94
  /home/runner/gold-investment-backend/tests/test_rate_limiting.py:94: PytestUnknownMarkWarning: Unknown pytest.mark.redis - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.redis

tests/test_rate_limiting.py:141
  /home/runner/gold-investment-backend/tests/test_rate_limiting.py:141: PytestUnknownMarkWarning: Unknown pytest.mark.redis - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.redis

tests/config/test_devices.py:5
  /home/runner/gold-investment-backend/tests/config/test_devices.py:5: PytestCollectionWarning: cannot collect test class 'TestDevice' because it has a __init__ constructor (from: config/test_devices.py)
    @dataclass

test_api.py::test_transform_endpoint
  /home/runner/gold-investment-backend/.pythonlibs/lib/python3.11/site-packages/flask_admin/contrib/__init__.py:2: DeprecationWarning: Deprecated call to `pkg_resources.declare_namespace('flask_admin.contrib')`.
  Implementing implicit namespace packages (as specified in PEP 420) is preferred to `pkg_resources.declare_namespace`. See https://setuptools.pypa.io/en/latest/references/keywords.html#keyword-namespace-packages
    __import__('pkg_resources').declare_namespace(__name__)

test_api.py::test_transform_endpoint
  /home/runner/gold-investment-backend/.pythonlibs/lib/python3.11/site-packages/pkg_resources/__init__.py:2558: DeprecationWarning: Deprecated call to `pkg_resources.declare_namespace('flask_admin')`.
  Implementing implicit namespace packages (as specified in PEP 420) is preferred to `pkg_resources.declare_namespace`. See https://setuptools.pypa.io/en/latest/references/keywords.html#keyword-namespace-packages
    declare_namespace(parent)

test_api.py::test_transform_endpoint
  /home/runner/gold-investment-backend/.pythonlibs/lib/python3.11/site-packages/flask_admin/contrib/sqla/tools.py:227: SAWarning: relationship 'User.rewards' will copy column users.id to column gold_rewards.user_id, which conflicts with relationship(s): 'User.gold_rewards' (copies users.id to gold_rewards.user_id). If this is not the intention, consider if these relationships should be linked with back_populates, or if viewonly=True should be applied to one or more if they are read-only. For the less common case that foreign key constraints are partially overlapping, the orm.foreign() annotation can be used to isolate the columns that should be written towards.   To silence this warning, add the parameter 'overlaps="gold_rewards"' to the 'User.rewards' relationship. (Background on this warning at: https://sqlalche.me/e/20/qzyx) (This warning originated from the `configure_mappers()` process, which was invoked automatically in response to a user-initiated operation.)
    return hasattr(attr, 'property') and hasattr(attr.property, 'direction')

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
======================================== short test summary info ========================================
FAILED tests/test_batch_collection_service.py::TestBatchCollectionService::test_duplicate_transaction_references - sqlalchemy.exc.NoReferencedTableError: Foreign key associated with column 'bonus_transactions.user_i...
FAILED tests/test_batch_collection_service.py::TestBatchCollectionService::test_empty_transaction_batch - sqlalchemy.exc.NoReferencedTableError: Foreign key associated with column 'bonus_transactions.user_i...
FAILED tests/test_batch_collection_service.py::TestBatchCollectionService::test_invalid_gold_transfer - sqlalchemy.exc.NoReferencedTableError: Foreign key associated with column 'bonus_transactions.user_i...
FAILED tests/test_batch_collection_service.py::TestBatchCollectionService::test_large_transaction_batch - sqlalchemy.exc.NoReferencedTableError: Foreign key associated with column 'bonus_transactions.user_i...
FAILED tests/test_batch_collection_service.py::TestBatchCollectionService::test_process_batch_transfers - sqlalchemy.exc.NoReferencedTableError: Foreign key associated with column 'bonus_transactions.user_i...
FAILED tests/test_blockchain_integration.py::test_contract_deployment - AttributeError: 'BlockchainService' object has no attribute 'deploy_contract'
FAILED tests/test_blockchain_integration.py::test_connection - AttributeError: 'Web3' object has no attribute 'isConnected'
FAILED tests/test_blockchain_service.py::test_batch_transform - TypeError: BlockchainService.process_batch_transformation() takes 2 positional arguments but 5 were ...
FAILED tests/test_blockchain_service.py::test_noble_rank_update - ValueError: Blockchain connection or account not initialized
FAILED tests/test_blockchain_service.py::test_gas_optimization - AttributeError: 'BlockchainService' object has no attribute '_get_optimal_gas_price'
FAILED tests/test_multi_device.py::test_responsive_layout[desktop-device0] - sqlalchemy.exc.NoReferencedTableError: Foreign key associated with column 'bonus_transactions.user_i...
FAILED tests/test_multi_device.py::test_responsive_layout[mobile-device1] - sqlalchemy.exc.NoReferencedTableError: Foreign key associated with column 'bonus_transactions.user_i...
FAILED tests/test_multi_device.py::test_responsive_layout[tablet-device2] - sqlalchemy.exc.NoReferencedTableError: Foreign key associated with column 'bonus_transactions.user_i...
FAILED tests/test_rate_limiting.py::TestRobustRateLimiter::test_local_rate_limiting - NameError: name 'RateLimit' is not defined
FAILED tests/test_rate_limiting.py::TestRobustRateLimiter::test_redis_rate_limiting - NameError: name 'RateLimit' is not defined
FAILED tests/test_rate_limiting.py::TestRobustRateLimiter::test_window_expiration - NameError: name 'RateLimit' is not defined
FAILED tests/test_rate_limiting.py::TestRobustRateLimiter::test_redis_window_expiration - NameError: name 'RateLimit' is not defined
FAILED tests/test_rate_limiting.py::TestRobustRateLimiter::test_identifier_generation - AttributeError: 'RobustRateLimiter' object has no attribute '_get_identifier'
FAILED tests/test_rate_limiting.py::TestRobustRateLimiter::test_rate_limit_configurations[1-1-True] - NameError: name 'RateLimit' is not defined
FAILED tests/test_rate_limiting.py::TestRobustRateLimiter::test_rate_limit_configurations[1-1-False] - NameError: name 'RateLimit' is not defined
FAILED tests/test_rate_limiting.py::TestRobustRateLimiter::test_rate_limit_configurations[5-1-True] - NameError: name 'RateLimit' is not defined
FAILED tests/test_rate_limiting.py::TestRobustRateLimiter::test_rate_limit_configurations[0-1-False] - NameError: name 'RateLimit' is not defined
FAILED tests/test_rate_limiting.py::TestRobustRateLimiter::test_redis_failure_fallback - NameError: name 'RateLimit' is not defined
FAILED tests/test_system_flow.py::test_complete_transformation_flow - RuntimeError: Working outside of application context.
FAILED tests/test_transformation_service.py::test_transform_to_gold - RuntimeError: Working outside of application context.
ERROR tests/test_api.py::test_transform_endpoint - sqlalchemy.exc.NoReferencedTableError: Foreign key associated with column 'bonus_transactions.user_i...
ERROR tests/test_auth.py::test_noble_relation_verification - sqlalchemy.exc.NoReferencedTableError: Foreign key associated with column 'bonus_transactions.user_i...
ERROR tests/test_auth.py::test_token_verification - sqlalchemy.exc.NoReferencedTableError: Foreign key associated with column 'bonus_transactions.user_i...
ERROR tests/test_auth.py::test_invalid_token - sqlalchemy.exc.NoReferencedTableError: Foreign key associated with column 'bonus_transactions.user_i...
ERROR tests/test_bonus_system.py::test_bonus_calculation - sqlalchemy.exc.NoReferencedTableError: Foreign key associated with column 'bonus_transactions.user_i...
ERROR tests/test_bonus_system.py::test_bonus_distribution - sqlalchemy.exc.NoReferencedTableError: Foreign key associated with column 'bonus_transactions.user_i...
ERROR tests/test_bonus_system.py::test_rank_based_bonus - sqlalchemy.exc.NoReferencedTableError: Foreign key associated with column 'bonus_transactions.user_i...
ERROR tests/test_bonus_system.py::test_multi_level_bonus_distribution - sqlalchemy.exc.NoReferencedTableError: Foreign key associated with column 'bonus_transactions.user_i...
ERROR tests/test_complete_system.py::test_system_health - sqlalchemy.exc.NoReferencedTableError: Foreign key associated with column 'bonus_transactions.user_i...
ERROR tests/test_complete_system.py::test_user_balance - sqlalchemy.exc.NoReferencedTableError: Foreign key associated with column 'bonus_transactions.user_i...
ERROR tests/test_complete_system.py::test_transformation_flow - sqlalchemy.exc.NoReferencedTableError: Foreign key associated with column 'bonus_transactions.user_i...
ERROR tests/integration/test_batch_blockchain.py::test_batch_blockchain_integration - sqlalchemy.exc.NoReferencedTableError: Foreign key associated with column 'bonus_transactions.user_i...
ERROR tests/integration/test_batch_blockchain.py::test_batch_validation - sqlalchemy.exc.NoReferencedTableError: Foreign key associated with column 'bonus_transactions.user_i...
========================= 25 failed, 2 passed, 8 warnings, 13 errors in 10.93s ==========================
~/gold-investment-backend$ 